<!DOCTYPE html>
<html>

<head>
  <title>Reproductor Corregido</title>
  <style>
    #castButton {
      background: #ff0000;
      color: white;
      padding: 15px;
      cursor: pointer;
    }
  </style>
  <!-- Carga las APIs necesarias -->
  <script src="https://www.youtube.com/iframe_api"></script>
  <script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js"></script>
</head>

<body>
  <button id="castButton" onclick="startCasting()">TRANSMITIR AL TV üî¥</button>
  <div id="player"></div>

  <script>
    const videoId = 'dQw4w9WgXcQ'; // ID de Rick Astley
    let player;
    let isPlayerReady = false; // Bandera para verificar estado

    // Inicializa el reproductor
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '360',
        width: '640',
        videoId: videoId,
        playerVars: {
          enablejsapi: 1,
          origin: 'https://elegant-puppy-765565.netlify.app/'
        },
        events: {
          'onReady': () => {
            isPlayerReady = true;
            console.log("Reproductor listo ‚úÖ");
          }
        }
      });
    }

    // Funci√≥n para iniciar Cast
    function startCasting() {
      try {
        // Verifica que el reproductor est√© listo
        if (!isPlayerReady) {
          alert("Espera a que el reproductor cargue ‚è≥");
          return;
        }

        // Verifica la API de Cast
        if (!window.chrome?.cast?.isAvailable) {
          alert("Habilita Google Cast en Chrome o usa modo normal (no inc√≥gnito).");
          return;
        }

        // Inicia la transmisi√≥n
        if (player.cast) {
          player.cast.castVideo();
        } else {
          console.error("player.cast no est√° disponible");
          alert("Actualiza Chrome o verifica la URL (debe ser HTTPS).");
        }
      } catch (error) {
        console.error("Error cr√≠tico:", error);
      }
    }
  </script>
</body>

</html>